SELECT * FROM (
        SELECT vbNumber, enrolmentNumber, caseId, workOrderId, voucher, SUM(lineItemAmount) AS voucherAmount, updateDate, CONVERT(smalldatetime, updateDate) AS lastUpdateDate
        FROM (
          SELECT DISTINCT D.VOUCHER_ID AS voucher,
          A.CHARTFIELD1 AS vbNumber,
          A.CHARTFIELD2 AS enrolmentNumber,
          A.CHARTFIELD3 AS caseId,
          A.SO_ID AS workOrderId,
          A.TWC_SO_LINE,
          E.MONETARY_AMOUNT AS lineItemAmount,
          D.LAST_UPDATE_DTTM AS updateDate
          FROM dbo.PS_PO_REQLOAD_RQST AS A
          INNER JOIN dbo.PS_PO_LINE_DISTRIB AS B ON A.REQ_ID = B.REQ_ID AND A.LINE_NBR = B.LINE_NBR AND A.CHARTFIELD3=B.CHARTFIELD3
          INNER JOIN dbo.PS_PO_LINE AS L ON B.PO_ID = L.PO_ID AND B.LINE_NBR = L.LINE_NBR
          INNER JOIN dbo.PS_VOUCHER_LINE AS C ON L.PO_ID = C.PO_ID AND L.LINE_NBR = C.LINE_NBR
          INNER JOIN dbo.PS_VOUCHER AS D ON C.BUSINESS_UNIT = D.BUSINESS_UNIT AND C.VOUCHER_ID = D.VOUCHER_ID
          INNER JOIN dbo.PS_PYMNT_VCHR_XREF AS P ON D.BUSINESS_UNIT = P.BUSINESS_UNIT AND D.VOUCHER_ID = P.VOUCHER_ID
          INNER JOIN dbo.PS_VCHR_ACCTG_LINE AS E ON C.BUSINESS_UNIT = E.BUSINESS_UNIT AND C.VOUCHER_ID = E.VOUCHER_ID AND C.VOUCHER_LINE_NUM = E.VOUCHER_LINE_NUM AND E.CHARTFIELD3=A.CHARTFIELD3
          INNER JOIN dbo.PS_PAYMENT_TBL AS T ON P.BANK_SETID = T.BANK_SETID AND P.BANK_CD = T.BANK_CD AND P.BANK_ACCT_KEY = T.BANK_ACCT_KEY AND P.PYMNT_ID = T.PYMNT_ID
          WHERE (C.BUSINESS_UNIT = 'ON100') AND (D.ENTRY_STATUS <> 'X') AND E.ACCOUNTING_DT > '2015-01-25') AS F
          GROUP BY voucher, vbNumber, enrolmentNumber, caseId, workOrderId, updateDate
      ) G where lastUpdateDate > '2025-04-15 00:00:00.000' and lastUpdateDate < '2025-04-16 00:00:00.000'  order by lastUpdateDate asc
